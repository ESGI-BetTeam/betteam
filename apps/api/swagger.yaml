openapi: 3.0.3
info:
  title: BetTeam API
  description: |
    API backend pour BetTeam - Plateforme de paris sportifs entre amis

    ## Fonctionnalités principales
    - Authentification et gestion des utilisateurs
    - Création et gestion de ligues privées
    - Paris de groupe (Group Bets) avec cotes réelles
    - Synchronisation des matchs via TheSportsDB
    - Récupération des cotes via The Odds API
    - Suivi des résultats et classements

    ## APIs externes
    - **TheSportsDB** - Matchs, équipes, compétitions
    - **The Odds API** - Cotes des bookmakers (Top 5 ligues européennes)

  version: 1.4.0
  contact:
    name: BetTeam Support
    email: support@betteam.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api
    description: Serveur de développement local
  - url: https://api.betteam.com/api
    description: Serveur de production

tags:
  - name: Health
    description: Endpoints de santé et statut de l'API
  - name: Auth
    description: Authentification et gestion des sessions
  - name: Users
    description: Gestion des utilisateurs (CRUD)
  - name: Competitions
    description: Gestion des compétitions sportives
  - name: Teams
    description: Gestion des équipes sportives
  - name: Matches
    description: Gestion des matchs sportifs
  - name: Odds
    description: Cotes des paris (The Odds API)
  - name: Leagues
    description: Gestion des ligues privées
  - name: League Members
    description: Gestion des membres d'une ligue
  - name: League Stats
    description: Classement et statistiques des ligues
  - name: Group Bets
    description: Paris de groupe - Matchs proposés aux membres d'une ligue
  - name: Bets
    description: Gestion des paris
  - name: Sync
    description: Synchronisation des données externes (TheSportsDB, The Odds API)
  - name: Cleanup
    description: Nettoyage des données obsolètes (matchs terminés, cotes, tokens expirés)

paths:
  /health:
    get:
      tags:
        - Health
      summary: Vérifier l'état de l'API
      description: Endpoint pour vérifier que l'API fonctionne correctement
      operationId: checkHealth
      responses:
        '200':
          description: L'API fonctionne correctement
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                    example: '2024-01-08T12:00:00Z'
                  uptime:
                    type: number
                    description: Temps de fonctionnement en secondes
                    example: 3600

  # ============================================
  # AUTH ENDPOINTS
  # ============================================
  /auth/register:
    post:
      tags:
        - Auth
      summary: Créer un nouveau compte utilisateur
      description: Inscription d'un nouvel utilisateur sur la plateforme
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - username
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                username:
                  type: string
                  minLength: 3
                  maxLength: 30
                  example: johndoe
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePass123!
                firstName:
                  type: string
                  example: John
                lastName:
                  type: string
                  example: Doe
      responses:
        '201':
          description: Utilisateur créé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    description: Access token JWT
                  refreshToken:
                    type: string
                    description: Refresh token
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Email ou username déjà utilisé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags:
        - Auth
      summary: Se connecter
      description: Authentification d'un utilisateur existant
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
      responses:
        '200':
          description: Connexion réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  token:
                    type: string
                    description: JWT token pour l'authentification
                  refreshToken:
                    type: string
                    description: Refresh token
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/me:
    get:
      tags:
        - Auth
      summary: Obtenir le profil de l'utilisateur connecté
      description: Récupère les informations de l'utilisateur actuellement authentifié
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profil utilisateur
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags:
        - Auth
      summary: Se déconnecter
      description: Révoque les refresh tokens de l'utilisateur
      operationId: logout
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Refresh token à révoquer (optionnel, révoque tous si non fourni)
      responses:
        '200':
          description: Déconnexion réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Auth
      summary: Rafraîchir le token
      description: Obtient un nouveau access token avec le refresh token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Tokens rafraîchis
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  expiresIn:
                    type: integer
                    description: Durée de validité en secondes
                    example: 900
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Mot de passe oublié
      description: Envoie un email de réinitialisation de mot de passe
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Email envoyé (toujours succès pour éviter l'énumération)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: If an account with that email exists, a password reset link has been sent.

  /auth/reset-password:
    post:
      tags:
        - Auth
      summary: Réinitialiser le mot de passe
      description: Réinitialise le mot de passe avec le token reçu par email
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Mot de passe réinitialisé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password has been reset successfully.
        '400':
          $ref: '#/components/responses/BadRequest'

  # ============================================
  # USERS ENDPOINTS
  # ============================================
  /users:
    get:
      tags:
        - Users
      summary: Lister les utilisateurs
      description: Récupère la liste des utilisateurs avec pagination et recherche
      operationId: getUsers
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Nombre d'éléments par page
        - name: search
          in: query
          schema:
            type: string
          description: Recherche par username, email, prénom ou nom
      responses:
        '200':
          description: Liste des utilisateurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/{id}:
    get:
      tags:
        - Users
      summary: Récupérer un utilisateur
      description: Récupère les informations d'un utilisateur par son ID
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Utilisateur trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Users
      summary: Modifier son profil
      description: Met à jour les informations de l'utilisateur connecté (seulement son propre compte)
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                username:
                  type: string
                  minLength: 3
                  maxLength: 30
                firstName:
                  type: string
                lastName:
                  type: string
                avatar:
                  type: string
                  format: uri
      responses:
        '200':
          description: Profil mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Email ou username déjà utilisé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Users
      summary: Désactiver son compte
      description: Soft delete - désactive le compte de l'utilisateur
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Compte désactivé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account deactivated successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/{id}/password:
    post:
      tags:
        - Users
      summary: Changer son mot de passe
      description: Permet à l'utilisateur de changer son mot de passe
      operationId: updatePassword
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Mot de passe mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Mot de passe actuel incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ============================================
  # LEAGUES ENDPOINTS
  # ============================================
  /leagues:
    get:
      tags:
        - Leagues
      summary: Lister ses ligues
      description: Récupère la liste des ligues dont l'utilisateur est membre
      operationId: getLeagues
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
          description: Nombre d'éléments par page
        - name: search
          in: query
          schema:
            type: string
          description: Recherche par nom ou description
      responses:
        '200':
          description: Liste des ligues
          content:
            application/json:
              schema:
                type: object
                properties:
                  leagues:
                    type: array
                    items:
                      $ref: '#/components/schemas/League'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Leagues
      summary: Créer une nouvelle ligue
      description: Crée une nouvelle ligue. L'utilisateur devient automatiquement owner et premier membre.
      operationId: createLeague
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: Ligue des Champions Entre Potes
                description:
                  type: string
                  maxLength: 500
                  example: Notre ligue privée pour parier sur la Champions League
                isPrivate:
                  type: boolean
                  default: true
                  description: Ligue privée (sur invitation) ou publique
      responses:
        '201':
          description: Ligue créée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/League'
                  message:
                    type: string
                    example: League created successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /leagues/{id}:
    get:
      tags:
        - Leagues
      summary: Obtenir les détails d'une ligue
      description: Récupère les informations détaillées d'une ligue avec ses membres
      operationId: getLeagueById
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Détails de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/LeagueWithMembers'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Leagues
      summary: Modifier une ligue
      description: Met à jour les informations d'une ligue (owner ou admin uniquement)
      operationId: updateLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                isPrivate:
                  type: boolean
      responses:
        '200':
          description: Ligue mise à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/League'
                  message:
                    type: string
                    example: League updated successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Leagues
      summary: Supprimer une ligue
      description: Soft delete d'une ligue (owner uniquement)
      operationId: deleteLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Ligue supprimée
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: League deleted successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/regenerate-code:
    post:
      tags:
        - Leagues
      summary: Régénérer le code d'invitation
      description: Génère un nouveau code d'invitation pour la ligue (owner ou admin)
      operationId: regenerateInviteCode
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Code régénéré
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviteCode:
                    type: string
                    example: A1B2C3D4
                  message:
                    type: string
                    example: Invite code regenerated successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # LEAGUE MEMBERS ENDPOINTS
  # ============================================
  /leagues/{id}/join:
    post:
      tags:
        - League Members
      summary: Rejoindre une ligue
      description: Rejoindre une ligue via son code d'invitation
      operationId: joinLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - inviteCode
              properties:
                inviteCode:
                  type: string
                  example: A1B2C3D4
                  description: Code d'invitation de la ligue (8 caractères)
      responses:
        '201':
          description: Membre ajouté avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/LeagueMember'
                  message:
                    type: string
                    example: Successfully joined the league.
        '400':
          description: Code invalide ou limite de membres atteinte
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Déjà membre de cette ligue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /leagues/{id}/leave:
    post:
      tags:
        - League Members
      summary: Quitter une ligue
      description: Quitter une ligue (le owner ne peut pas quitter)
      operationId: leaveLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Ligue quittée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Successfully left the league.
        '400':
          description: Le owner ne peut pas quitter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/members:
    get:
      tags:
        - League Members
      summary: Lister les membres d'une ligue
      description: Récupère la liste des membres avec pagination et tri
      operationId: getLeagueMembers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [points, joinedAt, username]
            default: points
          description: Champ de tri
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Ordre de tri
      responses:
        '200':
          description: Liste des membres
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/LeagueMember'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/members/{userId}:
    patch:
      tags:
        - League Members
      summary: Modifier le rôle d'un membre
      description: Change le rôle d'un membre (owner uniquement)
      operationId: updateMemberRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - $ref: '#/components/parameters/MemberUserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [admin, member]
                  description: Nouveau rôle du membre
      responses:
        '200':
          description: Rôle mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/LeagueMember'
                  message:
                    type: string
                    example: Member role updated to admin.
        '400':
          description: Impossible de modifier le rôle du owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - League Members
      summary: Exclure un membre
      description: Exclure un membre de la ligue (owner ou admin)
      operationId: kickMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - $ref: '#/components/parameters/MemberUserId'
      responses:
        '200':
          description: Membre exclu
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Member removed from the league.
        '400':
          description: Impossible d'exclure le owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Admins ne peuvent pas exclure d'autres admins
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # LEAGUE STATS ENDPOINTS
  # ============================================
  /leagues/{id}/leaderboard:
    get:
      tags:
        - League Stats
      summary: Classement de la ligue
      description: Récupère le classement des membres par points avec leurs statistiques de paris
      operationId: getLeagueLeaderboard
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Nombre de membres à afficher
      responses:
        '200':
          description: Classement de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      $ref: '#/components/schemas/LeaderboardEntry'
                  totalMembers:
                    type: integer
                    example: 25
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/stats:
    get:
      tags:
        - League Stats
      summary: Statistiques de la ligue
      description: Récupère les statistiques globales de la ligue
      operationId: getLeagueStats
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Statistiques de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  stats:
                    $ref: '#/components/schemas/LeagueStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/history:
    get:
      tags:
        - League Stats
      summary: Historique des paris de la ligue
      description: Récupère l'historique des paris de tous les membres de la ligue
      operationId: getLeagueHistory
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, won, lost, void]
          description: Filtrer par statut du pari
        - name: userId
          in: query
          schema:
            type: string
          description: Filtrer par utilisateur
      responses:
        '200':
          description: Historique des paris
          content:
            application/json:
              schema:
                type: object
                properties:
                  bets:
                    type: array
                    items:
                      $ref: '#/components/schemas/BetHistoryEntry'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # MATCHES ENDPOINTS
  # ============================================
  /matches:
    get:
      tags:
        - Matches
      summary: Lister les matchs
      description: Récupère la liste des matchs disponibles pour parier
      operationId: getMatches
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [upcoming, live, finished, postponed, cancelled]
          description: Filtrer par statut du match
        - name: sport
          in: query
          schema:
            type: string
          description: Filtrer par sport
        - name: competitionId
          in: query
          schema:
            type: string
          description: Filtrer par compétition
        - name: startDate
          in: query
          schema:
            type: string
            format: date
          description: Date de début (YYYY-MM-DD)
        - name: endDate
          in: query
          schema:
            type: string
            format: date
          description: Date de fin (YYYY-MM-DD)
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Liste des matchs
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  count:
                    type: integer
                    example: 25

  /matches/today:
    get:
      tags:
        - Matches
      summary: Matchs du jour
      description: Récupère les matchs programmés pour aujourd'hui
      operationId: getTodayMatches
      responses:
        '200':
          description: Liste des matchs du jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  count:
                    type: integer
                  date:
                    type: string
                    format: date
                    example: '2026-01-22'

  /matches/upcoming:
    get:
      tags:
        - Matches
      summary: Matchs à venir
      description: Récupère les matchs des 7 prochains jours
      operationId: getUpcomingMatches
      responses:
        '200':
          description: Liste des matchs à venir
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  count:
                    type: integer

  /matches/with-odds:
    get:
      tags:
        - Matches
        - Odds
      summary: Matchs avec cotes
      description: Récupère les matchs à venir avec leurs cotes de paris
      operationId: getMatchesWithOdds
      parameters:
        - name: competitionId
          in: query
          schema:
            type: string
          description: Filtrer par compétition
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
          description: Nombre max de résultats
        - name: onlyWithOdds
          in: query
          schema:
            type: boolean
            default: false
          description: Retourner uniquement les matchs avec cotes disponibles
      responses:
        '200':
          description: Liste des matchs avec cotes
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/MatchWithOdds'
                  count:
                    type: integer

  /matches/{id}:
    get:
      tags:
        - Matches
      summary: Détails d'un match
      description: Récupère les informations détaillées d'un match
      operationId: getMatchById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID du match
      responses:
        '200':
          description: Détails du match
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Match'
        '404':
          $ref: '#/components/responses/NotFound'

  /matches/{id}/odds:
    get:
      tags:
        - Matches
        - Odds
      summary: Cotes d'un match
      description: Récupère les cotes de paris pour un match spécifique
      operationId: getMatchOdds
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID du match
      responses:
        '200':
          description: Cotes du match
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchOddsResponse'
        '404':
          description: Cotes non disponibles pour ce match
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Odds not found for this match
                  message:
                    type: string
                    example: This match may not have odds available yet or is not supported by The Odds API

  # ============================================
  # BETS ENDPOINTS
  # ============================================
  /bets:
    post:
      tags:
        - Bets
      summary: Placer un pari
      description: Crée un nouveau pari sur un match
      operationId: createBet
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - matchId
                - leagueId
                - predictionType
                - predictionValue
                - amount
              properties:
                matchId:
                  type: string
                leagueId:
                  type: string
                predictionType:
                  type: string
                  enum: [winner, score, both_score]
                predictionValue:
                  type: string
                  description: Valeur de la prédiction (JSON)
                amount:
                  type: integer
                  minimum: 1
                  description: Montant du pari en points
      responses:
        '201':
          description: Pari créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bet'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

    get:
      tags:
        - Bets
      summary: Lister mes paris
      description: Récupère la liste des paris de l'utilisateur connecté
      operationId: getMyBets
      security:
        - bearerAuth: []
      parameters:
        - name: leagueId
          in: query
          schema:
            type: string
          description: Filtrer par ligue
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, won, lost, void]
          description: Filtrer par statut du pari
      responses:
        '200':
          description: Liste des paris
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Bet'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ============================================
  # COMPETITIONS ENDPOINTS
  # ============================================
  /competitions:
    get:
      tags:
        - Competitions
      summary: Lister les compétitions
      description: Récupère la liste des compétitions sportives disponibles
      operationId: getCompetitions
      parameters:
        - name: sport
          in: query
          schema:
            type: string
          description: Filtrer par sport (ex. Football)
        - name: country
          in: query
          schema:
            type: string
          description: Filtrer par pays
        - name: isActive
          in: query
          schema:
            type: boolean
          description: Filtrer par statut actif
      responses:
        '200':
          description: Liste des compétitions
          content:
            application/json:
              schema:
                type: object
                properties:
                  competitions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Competition'
                  count:
                    type: integer

  /competitions/{id}:
    get:
      tags:
        - Competitions
      summary: Détails d'une compétition
      description: Récupère les informations détaillées d'une compétition
      operationId: getCompetitionById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de la compétition
      responses:
        '200':
          description: Détails de la compétition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Competition'
        '404':
          $ref: '#/components/responses/NotFound'

  /competitions/{id}/teams:
    get:
      tags:
        - Competitions
      summary: Équipes d'une compétition
      description: Récupère la liste des équipes d'une compétition
      operationId: getCompetitionTeams
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de la compétition
      responses:
        '200':
          description: Liste des équipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: '#/components/schemas/Team'
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /competitions/{id}/matches:
    get:
      tags:
        - Competitions
      summary: Matchs d'une compétition
      description: Récupère la liste des matchs d'une compétition
      operationId: getCompetitionMatches
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de la compétition
        - name: status
          in: query
          schema:
            type: string
            enum: [upcoming, live, finished, postponed, cancelled]
          description: Filtrer par statut
      responses:
        '200':
          description: Liste des matchs
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # TEAMS ENDPOINTS
  # ============================================
  /teams:
    get:
      tags:
        - Teams
      summary: Lister les équipes
      description: Récupère la liste des équipes avec pagination et filtres
      operationId: getTeams
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Nombre d'éléments par page
        - name: search
          in: query
          schema:
            type: string
          description: Recherche par nom d'équipe
        - name: country
          in: query
          schema:
            type: string
          description: Filtrer par pays
      responses:
        '200':
          description: Liste des équipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: '#/components/schemas/TeamWithCounts'
                  pagination:
                    $ref: '#/components/schemas/Pagination'

  /teams/countries:
    get:
      tags:
        - Teams
      summary: Liste des pays
      description: Récupère la liste des pays disponibles
      operationId: getTeamCountries
      responses:
        '200':
          description: Liste des pays
          content:
            application/json:
              schema:
                type: object
                properties:
                  countries:
                    type: array
                    items:
                      type: string
                    example: [England, France, Germany, Spain, Italy]
                  count:
                    type: integer

  /teams/search:
    get:
      tags:
        - Teams
      summary: Rechercher des équipes
      description: Recherche d'équipes par nom
      operationId: searchTeams
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Terme de recherche
      responses:
        '200':
          description: Résultats de recherche
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: '#/components/schemas/Team'
                  count:
                    type: integer
                  query:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'

  /teams/{id}:
    get:
      tags:
        - Teams
      summary: Détails d'une équipe
      description: Récupère les informations détaillées d'une équipe
      operationId: getTeamById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
        - name: includeStats
          in: query
          schema:
            type: boolean
            default: false
          description: Inclure les statistiques
      responses:
        '200':
          description: Détails de l'équipe
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TeamWithDetails'
        '404':
          $ref: '#/components/responses/NotFound'

  /teams/{id}/stats:
    get:
      tags:
        - Teams
      summary: Statistiques d'une équipe
      description: Récupère les statistiques d'une équipe
      operationId: getTeamStats
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
      responses:
        '200':
          description: Statistiques de l'équipe
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      shortName:
                        type: string
                        nullable: true
                      logoUrl:
                        type: string
                        nullable: true
                  stats:
                    $ref: '#/components/schemas/TeamStats'
        '404':
          $ref: '#/components/responses/NotFound'

  /teams/{id}/matches:
    get:
      tags:
        - Teams
      summary: Matchs d'une équipe
      description: Récupère les matchs d'une équipe
      operationId: getTeamMatches
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
        - name: status
          in: query
          schema:
            type: string
            enum: [upcoming, live, finished, postponed, cancelled]
          description: Filtrer par statut
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Nombre max de résultats
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Décalage pour pagination
      responses:
        '200':
          description: Liste des matchs
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      shortName:
                        type: string
                        nullable: true
                      logoUrl:
                        type: string
                        nullable: true
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  total:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /teams/{id}/players:
    get:
      tags:
        - Teams
      summary: Joueurs d'une équipe
      description: Récupère les joueurs d'une équipe
      operationId: getTeamPlayers
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
      responses:
        '200':
          description: Liste des joueurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  team:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      shortName:
                        type: string
                        nullable: true
                      logoUrl:
                        type: string
                        nullable: true
                  players:
                    type: array
                    items:
                      $ref: '#/components/schemas/Player'
                  count:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /teams/{id}/favorite:
    post:
      tags:
        - Teams
      summary: Ajouter aux favoris
      description: Ajoute une équipe aux favoris de l'utilisateur
      operationId: addFavoriteTeam
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
      responses:
        '201':
          description: Équipe ajoutée aux favoris
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Team added to favorites
                  team:
                    $ref: '#/components/schemas/Team'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Teams
      summary: Retirer des favoris
      description: Retire une équipe des favoris de l'utilisateur
      operationId: removeFavoriteTeam
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
      responses:
        '200':
          description: Équipe retirée des favoris
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Team removed from favorites
        '401':
          $ref: '#/components/responses/Unauthorized'

  /teams/{id}/is-favorite:
    get:
      tags:
        - Teams
      summary: Vérifier si favori
      description: Vérifie si une équipe est dans les favoris de l'utilisateur
      operationId: checkFavoriteTeam
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'équipe
      responses:
        '200':
          description: Statut favori
          content:
            application/json:
              schema:
                type: object
                properties:
                  teamId:
                    type: string
                  isFavorite:
                    type: boolean
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/me/favorite-teams:
    get:
      tags:
        - Users
        - Teams
      summary: Mes équipes favorites
      description: Récupère les équipes favorites de l'utilisateur connecté
      operationId: getMyFavoriteTeams
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Nombre par page
      responses:
        '200':
          description: Liste des équipes favorites
          content:
            application/json:
              schema:
                type: object
                properties:
                  teams:
                    type: array
                    items:
                      $ref: '#/components/schemas/Team'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ============================================
  # GROUP BETS ENDPOINTS
  # ============================================
  /leagues/{id}/challenges:
    get:
      tags:
        - Group Bets
      summary: Lister les paris de groupe d'une ligue
      description: Récupère la liste des paris de groupe d'une ligue
      operationId: getLeagueGroupBets
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: status
          in: query
          schema:
            type: string
            enum: [open, closed, settled]
          description: Filtrer par statut
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Liste des paris de groupe
          content:
            application/json:
              schema:
                type: object
                properties:
                  challenges:
                    type: array
                    items:
                      $ref: '#/components/schemas/Challenge'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    post:
      tags:
        - Group Bets
      summary: Créer un pari de groupe
      description: Propose un match pour les paris de groupe de la ligue
      operationId: createGroupBet
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - matchId
              properties:
                matchId:
                  type: string
                  description: ID du match à proposer
      responses:
        '201':
          description: Pari de groupe créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  challenge:
                    $ref: '#/components/schemas/Challenge'
                  message:
                    type: string
                    example: Group bet created successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /leagues/{id}/challenges/active:
    get:
      tags:
        - Group Bets
      summary: Paris de groupe actifs
      description: Récupère les paris de groupe encore ouverts
      operationId: getActiveGroupBets
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Liste des paris de groupe actifs
          content:
            application/json:
              schema:
                type: object
                properties:
                  challenges:
                    type: array
                    items:
                      $ref: '#/components/schemas/Challenge'
                  count:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /leagues/{id}/challenges/{challengeId}:
    get:
      tags:
        - Group Bets
      summary: Détails d'un pari de groupe
      description: Récupère les informations détaillées d'un pari de groupe
      operationId: getGroupBetById
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: challengeId
          in: path
          required: true
          schema:
            type: string
          description: ID du pari de groupe
      responses:
        '200':
          description: Détails du pari de groupe
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeWithBets'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/challenges/{challengeId}/bets:
    get:
      tags:
        - Group Bets
      summary: Paris placés sur un pari de groupe
      description: Récupère les paris des membres sur un pari de groupe
      operationId: getGroupBetBets
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: challengeId
          in: path
          required: true
          schema:
            type: string
          description: ID du pari de groupe
      responses:
        '200':
          description: Liste des paris
          content:
            application/json:
              schema:
                type: object
                properties:
                  bets:
                    type: array
                    items:
                      $ref: '#/components/schemas/Bet'
                  count:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Group Bets
      summary: Placer un pari sur un pari de groupe
      description: Place un pari sur un pari de groupe actif
      operationId: placeBetOnGroupBet
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: challengeId
          in: path
          required: true
          schema:
            type: string
          description: ID du pari de groupe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - predictionType
                - predictionValue
                - amount
              properties:
                predictionType:
                  type: string
                  enum: [winner, score, both_score]
                predictionValue:
                  type: string
                  description: Valeur de la prédiction (JSON)
                amount:
                  type: integer
                  minimum: 1
                  description: Montant du pari en points
      responses:
        '201':
          description: Pari créé
          content:
            application/json:
              schema:
                type: object
                properties:
                  bet:
                    $ref: '#/components/schemas/Bet'
                  message:
                    type: string
                    example: Bet placed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /leagues/{id}/available-matches:
    get:
      tags:
        - Group Bets
      summary: Matchs disponibles pour paris de groupe
      description: Récupère les matchs de la compétition de la ligue disponibles pour créer un pari de groupe
      operationId: getAvailableMatchesForGroupBet
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Liste des matchs disponibles
          content:
            application/json:
              schema:
                type: object
                properties:
                  matches:
                    type: array
                    items:
                      $ref: '#/components/schemas/Match'
                  count:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /leagues/{id}/competition:
    get:
      tags:
        - Group Bets
      summary: Compétition de la ligue
      description: Récupère la compétition actuelle associée à la ligue
      operationId: getLeagueCompetition
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Compétition de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  competition:
                    $ref: '#/components/schemas/Competition'
                  canChange:
                    type: boolean
                    description: L'utilisateur peut-il changer la compétition
                  lastChangedAt:
                    type: string
                    format: date-time
                    nullable: true
        '401':
          $ref: '#/components/responses/Unauthorized'

    patch:
      tags:
        - Group Bets
      summary: Changer la compétition
      description: Change la compétition de la ligue (limité à 1x/semaine pour Free)
      operationId: changeLeagueCompetition
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - competitionId
              properties:
                competitionId:
                  type: string
                  description: ID de la nouvelle compétition
      responses:
        '200':
          description: Compétition changée
          content:
            application/json:
              schema:
                type: object
                properties:
                  competition:
                    $ref: '#/components/schemas/Competition'
                  message:
                    type: string
                    example: Competition changed successfully
        '400':
          description: Changement non autorisé (limite atteinte)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ============================================
  # SYNC ENDPOINTS
  # ============================================
  /sync/competitions:
    post:
      tags:
        - Sync
      summary: Synchroniser les compétitions
      description: Synchronise les compétitions depuis TheSportsDB
      operationId: syncCompetitions
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                leagueId:
                  type: string
                  description: ID TheSportsDB d'une compétition spécifique (optionnel)
      responses:
        '200':
          description: Synchronisation réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: All competitions synchronized successfully
                  count:
                    type: integer

  /sync/teams:
    post:
      tags:
        - Sync
      summary: Synchroniser les équipes
      description: Synchronise les équipes depuis TheSportsDB
      operationId: syncTeams
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                leagueId:
                  type: string
                  description: ID TheSportsDB d'une compétition (optionnel)
      responses:
        '200':
          description: Synchronisation réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Teams synchronized successfully

  /sync/matches:
    post:
      tags:
        - Sync
      summary: Synchroniser les matchs
      description: Synchronise les matchs depuis TheSportsDB
      operationId: syncMatches
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                leagueId:
                  type: string
                  description: ID TheSportsDB d'une compétition (optionnel)
                type:
                  type: string
                  enum: [upcoming, past]
                  description: Type de matchs à synchroniser
      responses:
        '200':
          description: Synchronisation réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Matches synchronized successfully

  /sync/players:
    post:
      tags:
        - Sync
      summary: Synchroniser les joueurs
      description: Synchronise les joueurs depuis TheSportsDB
      operationId: syncPlayers
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                teamId:
                  type: string
                  description: ID TheSportsDB d'une équipe (optionnel)
      responses:
        '200':
          description: Synchronisation réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Players synchronized successfully

  /sync/all:
    post:
      tags:
        - Sync
      summary: Synchronisation complète
      description: Synchronise compétitions, équipes et matchs
      operationId: syncAll
      responses:
        '200':
          description: Synchronisation complète réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Full synchronization completed successfully
                  steps:
                    type: array
                    items:
                      type: string
                    example: [competitions, teams, matches]

  /sync/odds:
    post:
      tags:
        - Sync
        - Odds
      summary: Synchroniser les cotes
      description: |
        Synchronise les cotes depuis The Odds API.

        **Attention:** Limité à 500 requêtes/mois. À utiliser avec parcimonie.
        Les CRON jobs (9h et 18h) gèrent la sync automatique.
      operationId: syncOdds
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                leagueId:
                  type: string
                  description: ID TheSportsDB d'une compétition spécifique (optionnel)
      responses:
        '200':
          description: Synchronisation des cotes réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Odds synchronization completed
                  competitionsSynced:
                    type: integer
                  matchesProcessed:
                    type: integer
                  matchesMatched:
                    type: integer
                  matchesUpdated:
                    type: integer
                  errors:
                    type: array
                    items:
                      type: string

  /sync/odds/status:
    get:
      tags:
        - Sync
        - Odds
      summary: Statut de sync des cotes
      description: Récupère les statistiques de synchronisation des cotes
      operationId: getOddsStatus
      responses:
        '200':
          description: Statut de synchronisation
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalOddsRecords:
                    type: integer
                  supportedCompetitions:
                    type: array
                    items:
                      type: object
                      properties:
                        oddsApiKey:
                          type: string
                          example: soccer_epl
                        theSportsDbId:
                          type: string
                          example: '4328'
                  apiStats:
                    type: object
                    properties:
                      isConfigured:
                        type: boolean
                      requestCountThisSession:
                        type: integer
                  recentSyncs:
                    type: array
                    items:
                      type: object
                      properties:
                        matchId:
                          type: string
                        match:
                          type: string
                          example: Manchester United vs Liverpool
                        competition:
                          type: string
                          example: Premier League
                        homeWinOdds:
                          type: number
                          example: 2.35
                        drawOdds:
                          type: number
                          example: 3.40
                        awayWinOdds:
                          type: number
                          example: 2.90
                        bookmakerCount:
                          type: integer
                          example: 15
                        syncedAt:
                          type: string
                          format: date-time

  /sync/status:
    get:
      tags:
        - Sync
      summary: Statut de synchronisation général
      description: Récupère les statistiques de synchronisation TheSportsDB
      operationId: getSyncStatus
      responses:
        '200':
          description: Statut de synchronisation
          content:
            application/json:
              schema:
                type: object
                properties:
                  counts:
                    type: object
                    properties:
                      competitions:
                        type: integer
                      teams:
                        type: integer
                      players:
                        type: integer
                      matches:
                        type: integer
                  recentLogs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        type:
                          type: string
                        status:
                          type: string
                        itemsSynced:
                          type: integer
                        durationMs:
                          type: integer
                        createdAt:
                          type: string
                          format: date-time
                        competition:
                          type: object
                          nullable: true
                          properties:
                            name:
                              type: string

  # ============================================
  # CLEANUP ENDPOINTS
  # ============================================

  /cleanup/stats:
    get:
      tags:
        - Cleanup
      summary: Statistiques de nettoyage
      description: Récupère les statistiques des données à nettoyer (matchs terminés, cotes obsolètes, etc.)
      operationId: getCleanupStats
      responses:
        '200':
          description: Statistiques de nettoyage
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Cleanup statistics
                  stats:
                    type: object
                    properties:
                      finishedMatchOdds:
                        type: integer
                        description: Nombre de cotes de matchs terminés à supprimer
                      finishedMatchesWithoutBets:
                        type: integer
                        description: Nombre de matchs terminés sans paris à supprimer
                      oldSyncLogs:
                        type: integer
                        description: Nombre de logs de sync de plus de 30 jours
                      expiredTokens:
                        type: integer
                        description: Nombre de tokens expirés

  /cleanup/run:
    post:
      tags:
        - Cleanup
      summary: Exécuter le nettoyage complet
      description: |
        Exécute le nettoyage complet en mode safe:
        - Supprime les cotes (MatchOdds) des matchs terminés
        - Supprime les matchs terminés SANS paris ni challenges
        - Supprime les logs de sync de plus de 30 jours
        - Supprime les tokens expirés

        Les matchs avec historique de paris sont conservés pour les statistiques.
      operationId: runCleanup
      responses:
        '200':
          description: Nettoyage effectué
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Cleanup completed successfully
                  result:
                    type: object
                    properties:
                      matchOddsDeleted:
                        type: integer
                      matchesDeleted:
                        type: integer
                      syncLogsDeleted:
                        type: integer
                      errors:
                        type: array
                        items:
                          type: string

  /cleanup/match-odds:
    post:
      tags:
        - Cleanup
      summary: Nettoyer les cotes des matchs terminés
      description: Supprime uniquement les cotes (MatchOdds) des matchs terminés, annulés ou reportés
      operationId: cleanupMatchOdds
      responses:
        '200':
          description: Cotes nettoyées
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Match odds cleanup completed
                  matchOddsDeleted:
                    type: integer

  /cleanup/matches:
    post:
      tags:
        - Cleanup
      summary: Nettoyer les matchs terminés sans paris
      description: Supprime uniquement les matchs terminés qui n'ont aucun pari ni challenge associé
      operationId: cleanupMatches
      responses:
        '200':
          description: Matchs nettoyés
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Matches cleanup completed
                  matchesDeleted:
                    type: integer

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtenu via /auth/login

  parameters:
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: ID unique de l'utilisateur

    LeagueId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: ID unique de la ligue

    MemberUserId:
      name: userId
      in: path
      required: true
      schema:
        type: string
      description: ID de l'utilisateur membre

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        email:
          type: string
          format: email
          example: user@example.com
        username:
          type: string
          example: johndoe
        firstName:
          type: string
          nullable: true
          example: John
        lastName:
          type: string
          nullable: true
          example: Doe
        avatar:
          type: string
          format: uri
          nullable: true
          example: https://api.betteam.com/avatars/user123.jpg
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    League:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        name:
          type: string
          example: Ligue des Champions Entre Potes
        description:
          type: string
          nullable: true
          example: Notre ligue privée pour parier sur la Champions League
        isPrivate:
          type: boolean
          example: true
        ownerId:
          type: string
          example: clx1234567890
        inviteCode:
          type: string
          example: A1B2C3D4
          description: Code d'invitation (masqué pour les membres non-admin)
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        owner:
          $ref: '#/components/schemas/User'
        _count:
          type: object
          properties:
            members:
              type: integer
              example: 12

    LeagueWithMembers:
      allOf:
        - $ref: '#/components/schemas/League'
        - type: object
          properties:
            members:
              type: array
              items:
                $ref: '#/components/schemas/LeagueMember'

    LeagueMember:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        leagueId:
          type: string
          example: clx1234567890
        userId:
          type: string
          example: clx1234567890
        role:
          type: string
          enum: [owner, admin, member]
          example: member
        points:
          type: integer
          example: 1250
          description: Points actuels du membre dans la ligue
        joinedAt:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/User'

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          example: 1
        userId:
          type: string
          example: clx1234567890
        username:
          type: string
          example: johndoe
        avatar:
          type: string
          nullable: true
        points:
          type: integer
          example: 1500
        totalBets:
          type: integer
          example: 25
        wonBets:
          type: integer
          example: 15
        lostBets:
          type: integer
          example: 8
        winRate:
          type: integer
          example: 60
          description: Taux de réussite en pourcentage
        joinedAt:
          type: string
          format: date-time

    LeagueStats:
      type: object
      properties:
        totalMembers:
          type: integer
          example: 25
        totalBets:
          type: integer
          example: 150
        totalBetsWon:
          type: integer
          example: 75
        totalBetsLost:
          type: integer
          example: 60
        totalBetsPending:
          type: integer
          example: 15
        averageWinRate:
          type: integer
          example: 55
          description: Taux de réussite moyen en pourcentage
        totalPointsWagered:
          type: integer
          example: 15000
        totalPointsWon:
          type: integer
          example: 8500
        mostActiveUser:
          type: object
          nullable: true
          properties:
            userId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
            totalBets:
              type: integer
        bestPerformer:
          type: object
          nullable: true
          properties:
            userId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
            winRate:
              type: integer
            wonBets:
              type: integer
        createdAt:
          type: string
          format: date-time
        lastActivityAt:
          type: string
          format: date-time
          nullable: true

    BetHistoryEntry:
      type: object
      properties:
        id:
          type: string
        oddsUser:
          type: object
          properties:
            oddsUserId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
        match:
          type: object
          properties:
            id:
              type: string
            homeTeam:
              type: string
            awayTeam:
              type: string
            homeScore:
              type: integer
              nullable: true
            awayScore:
              type: integer
              nullable: true
            startTime:
              type: string
              format: date-time
            status:
              type: string
        predictionType:
          type: string
        predictionValue:
          type: string
        amount:
          type: integer
        status:
          type: string
          enum: [pending, won, lost, void]
        potentialWin:
          type: integer
          nullable: true
        actualWin:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        settledAt:
          type: string
          format: date-time
          nullable: true

    Match:
      type: object
      properties:
        id:
          type: string
        externalId:
          type: string
        competitionId:
          type: string
        homeTeamId:
          type: string
        awayTeamId:
          type: string
        startTime:
          type: string
          format: date-time
        status:
          type: string
          enum: [upcoming, live, finished, postponed, cancelled]
        homeScore:
          type: integer
          nullable: true
        awayScore:
          type: integer
          nullable: true
        venue:
          type: string
          nullable: true
        round:
          type: string
          nullable: true
        homeTeam:
          $ref: '#/components/schemas/Team'
        awayTeam:
          $ref: '#/components/schemas/Team'
        competition:
          $ref: '#/components/schemas/Competition'

    MatchWithOdds:
      allOf:
        - $ref: '#/components/schemas/Match'
        - type: object
          properties:
            odds:
              $ref: '#/components/schemas/MatchOdds'

    MatchOdds:
      type: object
      nullable: true
      properties:
        homeWinOdds:
          type: number
          example: 2.35
        drawOdds:
          type: number
          example: 3.40
        awayWinOdds:
          type: number
          example: 2.90
        bookmakerCount:
          type: integer
          example: 15
        lastUpdated:
          type: string
          format: date-time
        oddsHomeTeam:
          type: string
          nullable: true
          description: Nom de l'équipe à domicile selon The Odds API
          example: Brest
        oddsAwayTeam:
          type: string
          nullable: true
          description: Nom de l'équipe à l'extérieur selon The Odds API
          example: Toulouse

    MatchOddsResponse:
      type: object
      properties:
        matchId:
          type: string
        match:
          type: object
          properties:
            homeTeam:
              $ref: '#/components/schemas/Team'
            awayTeam:
              $ref: '#/components/schemas/Team'
            competition:
              $ref: '#/components/schemas/Competition'
            startTime:
              type: string
              format: date-time
        odds:
          type: object
          properties:
            homeWin:
              type: number
              example: 2.35
            draw:
              type: number
              example: 3.40
            awayWin:
              type: number
              example: 2.90
            bookmakerCount:
              type: integer
              example: 15
            oddsHomeTeam:
              type: string
              nullable: true
              description: Nom de l'équipe à domicile selon The Odds API
              example: Brest
            oddsAwayTeam:
              type: string
              nullable: true
              description: Nom de l'équipe à l'extérieur selon The Odds API
              example: Toulouse
        lastUpdated:
          type: string
          format: date-time

    Team:
      type: object
      properties:
        id:
          type: string
        externalId:
          type: string
        name:
          type: string
          example: Manchester United
        shortName:
          type: string
          nullable: true
          example: Man Utd
        logoUrl:
          type: string
          nullable: true
        country:
          type: string
          nullable: true
          example: England

    TeamWithCounts:
      allOf:
        - $ref: '#/components/schemas/Team'
        - type: object
          properties:
            _count:
              type: object
              properties:
                players:
                  type: integer
                  example: 25
                homeMatches:
                  type: integer
                  example: 15
                awayMatches:
                  type: integer
                  example: 14

    TeamWithDetails:
      allOf:
        - $ref: '#/components/schemas/Team'
        - type: object
          properties:
            homeMatches:
              type: array
              items:
                $ref: '#/components/schemas/Match'
            awayMatches:
              type: array
              items:
                $ref: '#/components/schemas/Match'
            _count:
              type: object
              properties:
                players:
                  type: integer
                homeMatches:
                  type: integer
                awayMatches:
                  type: integer
            stats:
              $ref: '#/components/schemas/TeamStats'

    TeamStats:
      type: object
      properties:
        totalMatches:
          type: integer
          example: 29
        homeMatches:
          type: integer
          example: 15
        awayMatches:
          type: integer
          example: 14
        wins:
          type: integer
          example: 18
        draws:
          type: integer
          example: 5
        losses:
          type: integer
          example: 6
        goalsFor:
          type: integer
          example: 52
        goalsAgainst:
          type: integer
          example: 28
        goalDifference:
          type: integer
          example: 24
        winRate:
          type: integer
          example: 62
          description: Taux de victoire en pourcentage
        playersCount:
          type: integer
          example: 25

    Player:
      type: object
      properties:
        id:
          type: string
        externalId:
          type: string
        teamId:
          type: string
        name:
          type: string
          example: Marcus Rashford
        nationality:
          type: string
          nullable: true
          example: England
        position:
          type: string
          nullable: true
          example: Forward
        number:
          type: string
          nullable: true
          example: '10'
        dateOfBirth:
          type: string
          format: date
          nullable: true
        height:
          type: string
          nullable: true
          example: '1.85m'
        weight:
          type: string
          nullable: true
          example: '70kg'
        photoUrl:
          type: string
          nullable: true
        syncedAt:
          type: string
          format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Competition:
      type: object
      properties:
        id:
          type: string
        externalId:
          type: string
        name:
          type: string
          example: Premier League
        sport:
          type: string
          example: Football
        country:
          type: string
          nullable: true
          example: England
        logoUrl:
          type: string
          nullable: true
        isActive:
          type: boolean
          example: true

    Challenge:
      description: Pari de groupe (Group Bet) - Match proposé aux membres d'une ligue
      type: object
      properties:
        id:
          type: string
        leagueId:
          type: string
        matchId:
          type: string
        createdById:
          type: string
        status:
          type: string
          enum: [open, closed, settled]
        closesAt:
          type: string
          format: date-time
          description: Date limite pour parier (Match - 10min)
        createdAt:
          type: string
          format: date-time
        settledAt:
          type: string
          format: date-time
          nullable: true
        match:
          $ref: '#/components/schemas/Match'
        createdBy:
          $ref: '#/components/schemas/User'
        _count:
          type: object
          properties:
            bets:
              type: integer
              example: 5

    ChallengeWithBets:
      description: Pari de groupe avec la liste des paris des membres
      allOf:
        - $ref: '#/components/schemas/Challenge'
        - type: object
          properties:
            bets:
              type: array
              items:
                $ref: '#/components/schemas/Bet'

    Bet:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        matchId:
          type: string
        leagueId:
          type: string
        predictionType:
          type: string
          enum: [winner, score, both_score]
        predictionValue:
          type: string
        amount:
          type: integer
        status:
          type: string
          enum: [pending, won, lost, void]
        potentialWin:
          type: integer
          nullable: true
        actualWin:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        settledAt:
          type: string
          format: date-time
          nullable: true

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 100
        totalPages:
          type: integer
          example: 5

    Error:
      type: object
      properties:
        error:
          type: string
          example: Une erreur est survenue

  responses:
    BadRequest:
      description: Requête invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Les données fournies sont invalides

    Unauthorized:
      description: Non authentifié
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Token d'authentification manquant ou invalide

    Forbidden:
      description: Accès interdit
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: You do not have permission to perform this action.

    NotFound:
      description: Ressource non trouvée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: La ressource demandée n'existe pas
