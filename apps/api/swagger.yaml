openapi: 3.0.3
info:
  title: BetTeam API
  description: |
    API backend pour BetTeam - Plateforme de paris sportifs entre amis

    ## Fonctionnalités principales
    - Authentification et gestion des utilisateurs
    - Création et gestion de ligues privées
    - Paris sur des matchs sportifs
    - Suivi des résultats et classements

  version: 1.2.0
  contact:
    name: BetTeam Support
    email: support@betteam.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api
    description: Serveur de développement local
  - url: https://api.betteam.com/api
    description: Serveur de production

tags:
  - name: Health
    description: Endpoints de santé et statut de l'API
  - name: Auth
    description: Authentification et gestion des sessions
  - name: Users
    description: Gestion des utilisateurs (CRUD)
  - name: Leagues
    description: Gestion des ligues privées
  - name: League Members
    description: Gestion des membres d'une ligue
  - name: League Stats
    description: Classement et statistiques des ligues
  - name: Matches
    description: Gestion des matchs sportifs
  - name: Bets
    description: Gestion des paris

paths:
  /health:
    get:
      tags:
        - Health
      summary: Vérifier l'état de l'API
      description: Endpoint pour vérifier que l'API fonctionne correctement
      operationId: checkHealth
      responses:
        '200':
          description: L'API fonctionne correctement
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                    example: '2024-01-08T12:00:00Z'
                  uptime:
                    type: number
                    description: Temps de fonctionnement en secondes
                    example: 3600

  # ============================================
  # AUTH ENDPOINTS
  # ============================================
  /auth/register:
    post:
      tags:
        - Auth
      summary: Créer un nouveau compte utilisateur
      description: Inscription d'un nouvel utilisateur sur la plateforme
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - username
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                username:
                  type: string
                  minLength: 3
                  maxLength: 30
                  example: johndoe
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePass123!
                firstName:
                  type: string
                  example: John
                lastName:
                  type: string
                  example: Doe
      responses:
        '201':
          description: Utilisateur créé avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  token:
                    type: string
                    description: Access token JWT
                  refreshToken:
                    type: string
                    description: Refresh token
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Email ou username déjà utilisé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags:
        - Auth
      summary: Se connecter
      description: Authentification d'un utilisateur existant
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
      responses:
        '200':
          description: Connexion réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Login successful
                  token:
                    type: string
                    description: JWT token pour l'authentification
                  refreshToken:
                    type: string
                    description: Refresh token
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /auth/me:
    get:
      tags:
        - Auth
      summary: Obtenir le profil de l'utilisateur connecté
      description: Récupère les informations de l'utilisateur actuellement authentifié
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profil utilisateur
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/logout:
    post:
      tags:
        - Auth
      summary: Se déconnecter
      description: Révoque les refresh tokens de l'utilisateur
      operationId: logout
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                refreshToken:
                  type: string
                  description: Refresh token à révoquer (optionnel, révoque tous si non fourni)
      responses:
        '200':
          description: Déconnexion réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/refresh:
    post:
      tags:
        - Auth
      summary: Rafraîchir le token
      description: Obtient un nouveau access token avec le refresh token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
      responses:
        '200':
          description: Tokens rafraîchis
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                  refreshToken:
                    type: string
                  expiresIn:
                    type: integer
                    description: Durée de validité en secondes
                    example: 900
        '401':
          $ref: '#/components/responses/Unauthorized'

  /auth/forgot-password:
    post:
      tags:
        - Auth
      summary: Mot de passe oublié
      description: Envoie un email de réinitialisation de mot de passe
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: Email envoyé (toujours succès pour éviter l'énumération)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: If an account with that email exists, a password reset link has been sent.

  /auth/reset-password:
    post:
      tags:
        - Auth
      summary: Réinitialiser le mot de passe
      description: Réinitialise le mot de passe avec le token reçu par email
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - newPassword
              properties:
                token:
                  type: string
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Mot de passe réinitialisé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password has been reset successfully.
        '400':
          $ref: '#/components/responses/BadRequest'

  # ============================================
  # USERS ENDPOINTS
  # ============================================
  /users:
    get:
      tags:
        - Users
      summary: Lister les utilisateurs
      description: Récupère la liste des utilisateurs avec pagination et recherche
      operationId: getUsers
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Nombre d'éléments par page
        - name: search
          in: query
          schema:
            type: string
          description: Recherche par username, email, prénom ou nom
      responses:
        '200':
          description: Liste des utilisateurs
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/{id}:
    get:
      tags:
        - Users
      summary: Récupérer un utilisateur
      description: Récupère les informations d'un utilisateur par son ID
      operationId: getUserById
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Utilisateur trouvé
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Users
      summary: Modifier son profil
      description: Met à jour les informations de l'utilisateur connecté (seulement son propre compte)
      operationId: updateUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                username:
                  type: string
                  minLength: 3
                  maxLength: 30
                firstName:
                  type: string
                lastName:
                  type: string
                avatar:
                  type: string
                  format: uri
      responses:
        '200':
          description: Profil mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Email ou username déjà utilisé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Users
      summary: Désactiver son compte
      description: Soft delete - désactive le compte de l'utilisateur
      operationId: deleteUser
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: Compte désactivé
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account deactivated successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/{id}/password:
    post:
      tags:
        - Users
      summary: Changer son mot de passe
      description: Permet à l'utilisateur de changer son mot de passe
      operationId: updatePassword
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                  minLength: 6
      responses:
        '200':
          description: Mot de passe mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password updated successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: Mot de passe actuel incorrect
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          $ref: '#/components/responses/Forbidden'

  # ============================================
  # LEAGUES ENDPOINTS
  # ============================================
  /leagues:
    get:
      tags:
        - Leagues
      summary: Lister ses ligues
      description: Récupère la liste des ligues dont l'utilisateur est membre
      operationId: getLeagues
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Numéro de page
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
          description: Nombre d'éléments par page
        - name: search
          in: query
          schema:
            type: string
          description: Recherche par nom ou description
      responses:
        '200':
          description: Liste des ligues
          content:
            application/json:
              schema:
                type: object
                properties:
                  leagues:
                    type: array
                    items:
                      $ref: '#/components/schemas/League'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Leagues
      summary: Créer une nouvelle ligue
      description: Crée une nouvelle ligue. L'utilisateur devient automatiquement owner et premier membre.
      operationId: createLeague
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                  example: Ligue des Champions Entre Potes
                description:
                  type: string
                  maxLength: 500
                  example: Notre ligue privée pour parier sur la Champions League
                isPrivate:
                  type: boolean
                  default: true
                  description: Ligue privée (sur invitation) ou publique
      responses:
        '201':
          description: Ligue créée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/League'
                  message:
                    type: string
                    example: League created successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /leagues/{id}:
    get:
      tags:
        - Leagues
      summary: Obtenir les détails d'une ligue
      description: Récupère les informations détaillées d'une ligue avec ses membres
      operationId: getLeagueById
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Détails de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/LeagueWithMembers'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Leagues
      summary: Modifier une ligue
      description: Met à jour les informations d'une ligue (owner ou admin uniquement)
      operationId: updateLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 1
                  maxLength: 100
                description:
                  type: string
                  maxLength: 500
                isPrivate:
                  type: boolean
      responses:
        '200':
          description: Ligue mise à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  league:
                    $ref: '#/components/schemas/League'
                  message:
                    type: string
                    example: League updated successfully.
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Leagues
      summary: Supprimer une ligue
      description: Soft delete d'une ligue (owner uniquement)
      operationId: deleteLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Ligue supprimée
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: League deleted successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/regenerate-code:
    post:
      tags:
        - Leagues
      summary: Régénérer le code d'invitation
      description: Génère un nouveau code d'invitation pour la ligue (owner ou admin)
      operationId: regenerateInviteCode
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Code régénéré
          content:
            application/json:
              schema:
                type: object
                properties:
                  inviteCode:
                    type: string
                    example: A1B2C3D4
                  message:
                    type: string
                    example: Invite code regenerated successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # LEAGUE MEMBERS ENDPOINTS
  # ============================================
  /leagues/{id}/join:
    post:
      tags:
        - League Members
      summary: Rejoindre une ligue
      description: Rejoindre une ligue via son code d'invitation
      operationId: joinLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - inviteCode
              properties:
                inviteCode:
                  type: string
                  example: A1B2C3D4
                  description: Code d'invitation de la ligue (8 caractères)
      responses:
        '201':
          description: Membre ajouté avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/LeagueMember'
                  message:
                    type: string
                    example: Successfully joined the league.
        '400':
          description: Code invalide ou limite de membres atteinte
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Déjà membre de cette ligue
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /leagues/{id}/leave:
    post:
      tags:
        - League Members
      summary: Quitter une ligue
      description: Quitter une ligue (le owner ne peut pas quitter)
      operationId: leaveLeague
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Ligue quittée avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Successfully left the league.
        '400':
          description: Le owner ne peut pas quitter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/members:
    get:
      tags:
        - League Members
      summary: Lister les membres d'une ligue
      description: Récupère la liste des membres avec pagination et tri
      operationId: getLeagueMembers
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [points, joinedAt, username]
            default: points
          description: Champ de tri
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Ordre de tri
      responses:
        '200':
          description: Liste des membres
          content:
            application/json:
              schema:
                type: object
                properties:
                  members:
                    type: array
                    items:
                      $ref: '#/components/schemas/LeagueMember'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/members/{userId}:
    patch:
      tags:
        - League Members
      summary: Modifier le rôle d'un membre
      description: Change le rôle d'un membre (owner uniquement)
      operationId: updateMemberRole
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - $ref: '#/components/parameters/MemberUserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [admin, member]
                  description: Nouveau rôle du membre
      responses:
        '200':
          description: Rôle mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  member:
                    $ref: '#/components/schemas/LeagueMember'
                  message:
                    type: string
                    example: Member role updated to admin.
        '400':
          description: Impossible de modifier le rôle du owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - League Members
      summary: Exclure un membre
      description: Exclure un membre de la ligue (owner ou admin)
      operationId: kickMember
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - $ref: '#/components/parameters/MemberUserId'
      responses:
        '200':
          description: Membre exclu
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Member removed from the league.
        '400':
          description: Impossible d'exclure le owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Admins ne peuvent pas exclure d'autres admins
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # LEAGUE STATS ENDPOINTS
  # ============================================
  /leagues/{id}/leaderboard:
    get:
      tags:
        - League Stats
      summary: Classement de la ligue
      description: Récupère le classement des membres par points avec leurs statistiques de paris
      operationId: getLeagueLeaderboard
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 100
          description: Nombre de membres à afficher
      responses:
        '200':
          description: Classement de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  leaderboard:
                    type: array
                    items:
                      $ref: '#/components/schemas/LeaderboardEntry'
                  totalMembers:
                    type: integer
                    example: 25
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/stats:
    get:
      tags:
        - League Stats
      summary: Statistiques de la ligue
      description: Récupère les statistiques globales de la ligue
      operationId: getLeagueStats
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
      responses:
        '200':
          description: Statistiques de la ligue
          content:
            application/json:
              schema:
                type: object
                properties:
                  stats:
                    $ref: '#/components/schemas/LeagueStats'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /leagues/{id}/history:
    get:
      tags:
        - League Stats
      summary: Historique des paris de la ligue
      description: Récupère l'historique des paris de tous les membres de la ligue
      operationId: getLeagueHistory
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/LeagueId'
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 50
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, won, lost, void]
          description: Filtrer par statut du pari
        - name: userId
          in: query
          schema:
            type: string
          description: Filtrer par utilisateur
      responses:
        '200':
          description: Historique des paris
          content:
            application/json:
              schema:
                type: object
                properties:
                  bets:
                    type: array
                    items:
                      $ref: '#/components/schemas/BetHistoryEntry'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  # ============================================
  # MATCHES ENDPOINTS
  # ============================================
  /matches:
    get:
      tags:
        - Matches
      summary: Lister les matchs
      description: Récupère la liste des matchs disponibles pour parier
      operationId: getMatches
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [upcoming, live, finished, postponed, cancelled]
          description: Filtrer par statut du match
        - name: sport
          in: query
          schema:
            type: string
          description: Filtrer par sport
        - name: competitionId
          in: query
          schema:
            type: string
          description: Filtrer par compétition
        - name: startDate
          in: query
          schema:
            type: string
            format: date
          description: Date de début (YYYY-MM-DD)
        - name: endDate
          in: query
          schema:
            type: string
            format: date
          description: Date de fin (YYYY-MM-DD)
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Liste des matchs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Match'
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ============================================
  # BETS ENDPOINTS
  # ============================================
  /bets:
    post:
      tags:
        - Bets
      summary: Placer un pari
      description: Crée un nouveau pari sur un match
      operationId: createBet
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - matchId
                - leagueId
                - predictionType
                - predictionValue
                - amount
              properties:
                matchId:
                  type: string
                leagueId:
                  type: string
                predictionType:
                  type: string
                  enum: [winner, score, both_score]
                predictionValue:
                  type: string
                  description: Valeur de la prédiction (JSON)
                amount:
                  type: integer
                  minimum: 1
                  description: Montant du pari en points
      responses:
        '201':
          description: Pari créé avec succès
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Bet'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

    get:
      tags:
        - Bets
      summary: Lister mes paris
      description: Récupère la liste des paris de l'utilisateur connecté
      operationId: getMyBets
      security:
        - bearerAuth: []
      parameters:
        - name: leagueId
          in: query
          schema:
            type: string
          description: Filtrer par ligue
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, won, lost, void]
          description: Filtrer par statut du pari
      responses:
        '200':
          description: Liste des paris
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Bet'
        '401':
          $ref: '#/components/responses/Unauthorized'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtenu via /auth/login

  parameters:
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: ID unique de l'utilisateur

    LeagueId:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: ID unique de la ligue

    MemberUserId:
      name: userId
      in: path
      required: true
      schema:
        type: string
      description: ID de l'utilisateur membre

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        email:
          type: string
          format: email
          example: user@example.com
        username:
          type: string
          example: johndoe
        firstName:
          type: string
          nullable: true
          example: John
        lastName:
          type: string
          nullable: true
          example: Doe
        avatar:
          type: string
          format: uri
          nullable: true
          example: https://api.betteam.com/avatars/user123.jpg
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    League:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        name:
          type: string
          example: Ligue des Champions Entre Potes
        description:
          type: string
          nullable: true
          example: Notre ligue privée pour parier sur la Champions League
        isPrivate:
          type: boolean
          example: true
        ownerId:
          type: string
          example: clx1234567890
        inviteCode:
          type: string
          example: A1B2C3D4
          description: Code d'invitation (masqué pour les membres non-admin)
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        owner:
          $ref: '#/components/schemas/User'
        _count:
          type: object
          properties:
            members:
              type: integer
              example: 12

    LeagueWithMembers:
      allOf:
        - $ref: '#/components/schemas/League'
        - type: object
          properties:
            members:
              type: array
              items:
                $ref: '#/components/schemas/LeagueMember'

    LeagueMember:
      type: object
      properties:
        id:
          type: string
          example: clx1234567890
        leagueId:
          type: string
          example: clx1234567890
        userId:
          type: string
          example: clx1234567890
        role:
          type: string
          enum: [owner, admin, member]
          example: member
        points:
          type: integer
          example: 1250
          description: Points actuels du membre dans la ligue
        joinedAt:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/User'

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          example: 1
        userId:
          type: string
          example: clx1234567890
        username:
          type: string
          example: johndoe
        avatar:
          type: string
          nullable: true
        points:
          type: integer
          example: 1500
        totalBets:
          type: integer
          example: 25
        wonBets:
          type: integer
          example: 15
        lostBets:
          type: integer
          example: 8
        winRate:
          type: integer
          example: 60
          description: Taux de réussite en pourcentage
        joinedAt:
          type: string
          format: date-time

    LeagueStats:
      type: object
      properties:
        totalMembers:
          type: integer
          example: 25
        totalBets:
          type: integer
          example: 150
        totalBetsWon:
          type: integer
          example: 75
        totalBetsLost:
          type: integer
          example: 60
        totalBetsPending:
          type: integer
          example: 15
        averageWinRate:
          type: integer
          example: 55
          description: Taux de réussite moyen en pourcentage
        totalPointsWagered:
          type: integer
          example: 15000
        totalPointsWon:
          type: integer
          example: 8500
        mostActiveUser:
          type: object
          nullable: true
          properties:
            userId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
            totalBets:
              type: integer
        bestPerformer:
          type: object
          nullable: true
          properties:
            userId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
            winRate:
              type: integer
            wonBets:
              type: integer
        createdAt:
          type: string
          format: date-time
        lastActivityAt:
          type: string
          format: date-time
          nullable: true

    BetHistoryEntry:
      type: object
      properties:
        id:
          type: string
        oddsUser:
          type: object
          properties:
            oddsUserId:
              type: string
            username:
              type: string
            avatar:
              type: string
              nullable: true
        match:
          type: object
          properties:
            id:
              type: string
            homeTeam:
              type: string
            awayTeam:
              type: string
            homeScore:
              type: integer
              nullable: true
            awayScore:
              type: integer
              nullable: true
            startTime:
              type: string
              format: date-time
            status:
              type: string
        predictionType:
          type: string
        predictionValue:
          type: string
        amount:
          type: integer
        status:
          type: string
          enum: [pending, won, lost, void]
        potentialWin:
          type: integer
          nullable: true
        actualWin:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        settledAt:
          type: string
          format: date-time
          nullable: true

    Match:
      type: object
      properties:
        id:
          type: string
        externalId:
          type: string
        competitionId:
          type: string
        homeTeamId:
          type: string
        awayTeamId:
          type: string
        startTime:
          type: string
          format: date-time
        status:
          type: string
          enum: [upcoming, live, finished, postponed, cancelled]
        homeScore:
          type: integer
          nullable: true
        awayScore:
          type: integer
          nullable: true
        venue:
          type: string
          nullable: true
        round:
          type: string
          nullable: true
        homeTeam:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            logoUrl:
              type: string
              nullable: true
        awayTeam:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            logoUrl:
              type: string
              nullable: true
        competition:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            sport:
              type: string

    Bet:
      type: object
      properties:
        id:
          type: string
        userId:
          type: string
        matchId:
          type: string
        leagueId:
          type: string
        predictionType:
          type: string
          enum: [winner, score, both_score]
        predictionValue:
          type: string
        amount:
          type: integer
        status:
          type: string
          enum: [pending, won, lost, void]
        potentialWin:
          type: integer
          nullable: true
        actualWin:
          type: integer
          nullable: true
        createdAt:
          type: string
          format: date-time
        settledAt:
          type: string
          format: date-time
          nullable: true

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 100
        totalPages:
          type: integer
          example: 5

    Error:
      type: object
      properties:
        error:
          type: string
          example: Une erreur est survenue

  responses:
    BadRequest:
      description: Requête invalide
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Les données fournies sont invalides

    Unauthorized:
      description: Non authentifié
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: Token d'authentification manquant ou invalide

    Forbidden:
      description: Accès interdit
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: You do not have permission to perform this action.

    NotFound:
      description: Ressource non trouvée
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: La ressource demandée n'existe pas
